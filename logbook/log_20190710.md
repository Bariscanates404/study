
# Logs 20190710 

## ffmpeg video compression 20190711 

ref: `~/projects/study/logbook/ffmpeg_video_compression_20190711.md`

## cut video clips 20190711 

Moved to ref: Example: Extract clips from movie videos with subtitles 20190712 <url:/Users/mertnuhoglu/projects/study/code/anki/process_anki_video_flashcards.md#tn=Example: Extract clips from movie videos with subtitles 20190712>

### 01: çift zaman aralıklarını tekleştir

girdi:

		00:01:29,000 --> 00:01:30,161
		00:01:30,360 --> 00:01:32,886

çıktı:

		00:01:29,000 --> 00:01:32,886

``` bash
%s#-->\( [0-9:,]\+\n[0-9:,]\+ -->\)\+#-->#g
sed -e 's#-->\( [0-9:,]\+\n[0-9:,]\+ -->\)\+#-->#g' marks0.txt > marks1.txt
sed -e 's#-->\( [0-9:,]\+\n[0-9:,]\+ -->\)\+#-->#g' marks0.txt > marks1.txt
awk -v RS="\0" -v ORS="" '{gsub(/-->\( [0-9:,]\+\n[0-9:,]\+ -->\)\+/,"-->")}7' marks0.txt > marks1.txt
``` 

### 02: parantez içindeki kelimeleri sil

girdi:

		(STUTTERING) Oh my! She's back!

çıktı:

		Oh my! She's back!

``` bash
%s#([A-Z]\+) *##g
``` 

### 03: zaman aralıklarını dfye çevir

#### 03.01: metin kısmını tırnak içine al

input

		00:01:26,720 --> 00:01:28,324
		MAX: I've lived in this city all my life.

		00:01:29,000 --> 00:01:32,886
		I'm Max.
		And I'm the luckiest dog in New York

output

		00:01:26,720	00:01:28,324	"MAX: I've lived in this city all my life."
		00:01:29,000	00:01:32,886	"I'm Max.
		And I'm the luckiest dog in New York"

``` bash
echo "start_time\tend_time\ttext" > marks.tsv
cat marks.txt >> marks.tsv
``` 

Edit marks.tsv

``` vim
g/^\d\+$/d
  # wrap text lines inside double quotes
%s#\(^\D.*\n\)\+#"\0"#
g/^"$/ s/\n/###/g
%s/\n/@@@/g
%s/###/\r/g
%s/@@@"$/"/
%s/@@@"/\t"/
%s/ --> /\t/
g/^@@@$/d
%s/@@@/\r/g
%s#\(\d\d\),\(\d\d\d\)#\1.\2#g
``` 

Ara zaman rakamlarını tekrar sil

``` vim
\([0-9:,]\+@@@[0-9:,]\+ --> \)\+
``` 

#### 03.02 id ekle

önce df olarak oku

``` r
library(dplyr)
m0 = read.table("marks.tsv", stringsAsFactors = F, header = T) %>%
	dplyr::mutate(clip_id = dplyr::row_number())
``` 

#### 03.03 komutları çıktıla

``` r
m0 = read.table("marks.tsv", stringsAsFactors = F, header = T) %>%
	dplyr::mutate(clip_id = dplyr::row_number()) %>%
	dplyr::mutate(cmd = glue::glue("ffmpeg -i secret_life_of_pets.mp4 -ss {start_time} -to {end_time} -c:v libx264 -c:a libfaac secret_life_of_pets_{sprintf('%04d', clip_id)}.mp4")) %>%
	dplyr::select(clip_id, text, dplyr::everything())
writeLines(m0$cmd, "cmd.sh")
readr::write_tsv(m0, "clips.tsv")
``` 

Output: `~/gdrive/mynotes/stuff/ozgur_emin/english/anki/secret_life_of_pets/cmd.sh`

#### 03.04 duration hesapla

``` r
m0 = readr::read_tsv("marks.tsv") %>%
	dplyr::mutate(duration = end_time - start_time)
str(m0)
  ##>  $ start_time: 'hms' num  00:01:26 00:01:29 00:01:34 00:01:36 ...
  ##>   ..- attr(*, "units")= chr "secs"
``` 

#### run

``` bash
cd /Users/mertnuhoglu/Movies/secret_life_of_pets/
bash ~/gdrive/mynotes/stuff/ozgur_emin/english/anki/secret_life_of_pets/cmd.sh
``` 

