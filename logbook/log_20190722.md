
# Logs 20190722 

## Orjinal video dosyasını küçült 20190722 

``` bash
input=spotlight.mkv
out=spotlight.mp4
ffprobe -i ${input} 2>&1 | rg eng | rg Stream | rg Audio
  ##>     Stream #0:2(eng): Audio: dts (DTS), 48000 Hz, 5.1(side), fltp, 1536 kb/s
stream=2
VOLUME_INCREASE=2
ffmpeg -i ${input} \
	-map 0:0 -map 0:${stream} \
	-c:v libx264 -crf 23 -vf "scale=320:240" \
	-c:a aac -filter:a "volume=${VOLUME_INCREASE}" \
	$out
``` 

## Generate silence video

Ref: `~/projects/study/logbook/add_silence_to_video_20190722.md`

``` bash
input=spotlight.mp4
out=silence01.mp4
VOLUME_INCREASE=0.1
ffmpeg -ss 00:57 -to 01:00 -i ${input} -c:v libx264 -crf 23 -c:a aac -filter:a "volume=${VOLUME_INCREASE}" $out
input=$out
out=silence.mp4
ffmpeg -i ${input} -t 00:03 -c:v copy -c:a copy $out
ffprobe -i $out 2>&1 | rg Duration 
  ##>   Duration: 00:00:03.02, start: 0.000000, bitrate: 497 kb/s
cp $out clips_fixed
``` 

### alternatif silence parts

``` bash
input=spotlight.mp4
out=silence02.mp4
ffmpeg -ss 00:57 -to 01:00 -i ${input} -c:v libx264 -crf 23 -c:a aac -filter:a "volume=${VOLUME_INCREASE}" $out
ffmpeg -ss 00:56 -to 00:59 -i ${input} -c:v libx264 -crf 23 -c:a aac -filter:a "volume=${VOLUME_INCREASE}" $out
``` 

## Extract clips

Follow `Ex03: Extract clips from movie fideos with subtitles 20190712 <url:/Users/mertnuhoglu/projects/study/code/anki/process_anki_video_flashcards.md#tn=Ex03: Extract clips from movie fideos with subtitles 20190712>`

``` bash
clip_name=spotlight
``` 

``` bash
cp "${clip_name}.srt" marks.txt
nvim -c ":ConvertMarksTxt2MarksTsv" -c ":wq" marks.txt
echo "start_time\tend_time\ttext" > marks.tsv
cat marks.txt >> marks.tsv
``` 

``` bash
offset_clip_id=0
input="spotlight.mp4"
clip_name="spotlight"
R --vanilla -e "one.video.to.multiple.clips::main_generate_ffmpeg_cmd_for_splitting_videos('marks.tsv', offset_clip_id = ${offset_clip_id}, original_video = '${input}', clip_name = '${clip_name}')"
``` 

## Test merging

``` bash
clip_name=spotlight
ffmpeg -f concat -i clips_fixed/files04.in -c copy ${clip_name}_silence.mp4
``` 

## Tümünü çalıştır

``` bash
bash split01.sh
bash split02.sh
clip_name=spotlight
ffmpeg -f concat -i clips/video_files_merge.in -c copy ${clip_name}_silence.mp4
``` 

## Refactoring

``` bash
bash clips/split01.sh
bash clips/split02.sh
clip_name=spotlight
ffmpeg -f concat -i clips_fixed/video_files_merge.in -c copy ${clip_name}_silence.mp4
``` 

``` bash
clip_name=spotlight
ffmpeg -f concat -i clips/files05.in -c copy ${clip_name}_silence02.mp4
``` 

## Error: 

		error: bazı dosyalar niye yok?
			1004
				split01.sh içine bak
					NA varmış
					neden NA var?
						tab yok çünkü ilgili satırda
						00:50:30.737	00:50:33.907 <br> 1980, the year Geoghan was pulled from JP.	"It says he's on sick leave."
					bunları tespit edemiyor muyuz?

``` r
path = "marks.tsv"
m0 = read_marks_tsv(path)
m0 %>%
	filter(is.na(end_time))
``` 

opt

		NA olanları ayıkla
		NA olma sebebini çöz

opt01: NA olma sebebini çöz

ilgili satırı bul

		00:50:30.737	00:50:33.907 <br> 1980, the year Geoghan was pulled from JP.	"It says he's on sick leave."

Rakamla başlayan satırlar hep.

		1984.
		And Law just ignored it.

## Yeni video: zootopia

Follow `~/projects/study/code/anki/process_anki_video_flashcards.md`

01: compress video

``` bash
cd /Volumes/Elements/arsivden/cocuk/zootopia/
input=zootopia.mkv
clip_name=zootopia
output="${clip_name}.mp4"
ffprobe -i ${input} 2>&1 | rg eng | rg Stream | rg Audio
  ##>     Stream #0:2(eng): Audio: dts (DTS), 48000 Hz, 5.1(side), fltp, 1536 kb/s (default)
stream=2
VOLUME_INCREASE=2
``` 

``` bash
ffmpeg -i "${input}" \
	-map 0:0 -map 0:${stream} \
	-c:v libx264 -crf 28 -vf "scale=320:240" \
	-c:a aac -q:a 32 -filter:a "volume=${VOLUME_INCREASE}" \
	"${output}" 
``` 

02: split video into parts

Generate `marks.tsv`

``` bash
mkdir -p clips
cp "${clip_name}.srt" clips/marks.txt
nvim -c ":ConvertMarksTxt2MarksTsv" -c ":wq" clips/marks.txt
echo "start_time\tend_time\ttext" > clips/marks.tsv
cat clips/marks.txt >> clips/marks.tsv
``` 

``` bash
offset_clip_id=0
  ##> input="spotlight.mp4"
  ##> clip_name="spotlight"
R --vanilla -e "one.video.to.multiple.clips::main_generate_ffmpeg_cmd_for_splitting_videos(path = 'clips/marks.tsv', offset_clip_id = ${offset_clip_id}, original_video = '${input}', clip_name = '${clip_name}')"
``` 

split into parts

``` bash
bash clips/split01.sh
bash clips/split02.sh
``` 

03: Generate silence video file

``` bash
  ##> input=spotlight.mp4
silence01=clips/silence01.mp4
VOLUME_INCREASE=0.1
ffmpeg -ss 00:00 -to 00:03 -i ${input} -c:v libx264 -crf 23 -c:a aac -filter:a "volume=${VOLUME_INCREASE}" $silence01
out_silence=clips/silence.mp4
ffmpeg -i ${silence01} -t 00:03 -c:v copy -c:a copy $out_silence
ffprobe -i $out_silence 2>&1 | rg Duration 
  ##>   Duration: 00:00:03.02, start: 0.000000, bitrate: 497 kb/s
``` 

