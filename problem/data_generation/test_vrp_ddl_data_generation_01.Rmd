---
title: "Test VRP DDL Data Generation 01"
author: "Mert Nuhoglu"
output:
  html_document: default
path: ~/projects/study/problem/data_generation/test_vrp_ddl_data_generation_01.Rmd
---

## v01

```{r load_packages, include=FALSE}
   library(dplyr)
```

``` {bash}
datafiller --size=2 data/vrp_ddl_test_01.sql > data/vrp_ddl_test_01_data.sql
``` 

``` {bash}
cat data/vrp_ddl_test_01_data.sql
``` 

## v02

``` {bash}
datafiller --size=2 data/vrp_ddl_test_02.sql > data/vrp_ddl_test_02_data.sql
``` 

``` {bash}
cat data/vrp_ddl_test_02_data.sql
``` 

All BIGINT fields are left empty. It seems like datafiller does not support BIGINT properly.

## v03

``` {bash}
datafiller --size=2 data/vrp_ddl_test_03.sql > data/vrp_ddl_test_03_data.sql
``` 

``` {bash}
cat data/vrp_ddl_test_03_data.sql
``` 

## v04: Use Predefined Reference Ids as FK Data

Use the usual command `word` to reuse some predefined list of values:

``` sql
-- df place_enum: word=./data/place_enum.txt
CREATE TABLE place (
  ...
  ,  place_enum INT
  -- df: text=place_enum length=1 
  ...
```

Note that, `place_enum` is not a FK according to the above definition.

Predefined reference ids are here:

``` {bash}
cat data/place_enum.txt
``` 

``` {bash}
datafiller --size=5 data/vrp_ddl_test_04.sql > data/vrp_ddl_test_04_data.sql
``` 

``` {bash}
cat data/vrp_ddl_test_04_data.sql
``` 

## v05: Use Predefined Reference Ids together with REFERENCES clause

What if the referring column is defined as `FK`

``` sql
-- df place_enum: word=./data/place_enum.txt
CREATE TABLE enum_value (
  enum_value_id INT 
  -- df: text=place_enum length=1 
  ) ;
CREATE TABLE place (
  ...
  ,  place_enum INT REFERENCES enum_value (enum_value_id)
  -- df: text=place_enum length=1 
  ...
```

``` bash
datafiller --size=5 data/vrp_ddl_test_05.sql > data/vrp_ddl_test_05_data.sql
``` 

This doesn't work due to the following error:

``` 
## Traceback (most recent call last):
##   File "/usr/local/bin/datafiller", line 5067, in <module>
##     format(a.table.name, a.name, key.name)
## AssertionError: foreign key place.place_enum target enum_value_id must be unique
``` 

`datafiller` expects that `enum_value$enum_value_id` is unique when it is referenced by some FK.

``` {bash}
cat data/vrp_ddl_test_05_data.sql
``` 





